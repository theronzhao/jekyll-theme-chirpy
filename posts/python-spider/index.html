<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="爬虫与requests库" /><meta property="og:locale" content="en_US" /><meta name="description" content="HTTP基础" /><meta property="og:description" content="HTTP基础" /><link rel="canonical" href="https://justzxy.cn/posts/python-spider/" /><meta property="og:url" content="https://justzxy.cn/posts/python-spider/" /><meta property="og:site_name" content="图样图森破" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-06-20T21:11:21+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="爬虫与requests库" /><meta name="twitter:site" content="@" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"HTTP基础","url":"https://justzxy.cn/posts/python-spider/","headline":"爬虫与requests库","dateModified":"2021-06-20T21:11:21+08:00","datePublished":"2021-06-20T21:11:21+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://justzxy.cn/posts/python-spider/"},"@type":"BlogPosting","@context":"https://schema.org"}</script><title>爬虫与requests库 | 图样图森破</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="图样图森破"><meta name="application-name" content="图样图森破"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">图样图森破</a></div><div class="site-subtitle font-italic">Too Young Too Simple</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>爬虫与requests库</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>爬虫与requests库</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> tooYoungtooSimple </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Jun 20, 2021, 9:11 PM +0800" prep="on" > Jun 20 <i class="unloaded">2021-06-20T21:11:21+08:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2644 words">14 min</span></div></div><div class="post-content"><h1 id="http基础">HTTP基础</h1><p>网络爬虫(网页蜘蛛，网络机器人)，就是模拟客户端(主要指的的是浏览器)发送网络请求，接收请求响应，一种按照一定规则，自动的抓取互联网信息的程序</p><p>HTTP请求头：</p><ul><li>User-Agent：用户代理，提供浏览器信息和系统信息<li>Referer：页面跳转处，指的是这个请求从哪个url页面跳转过来的<li>Cookie：cookie状态保持<li>Authorization：用于表示HTTP协议中需要认证资源的认证信息，如jwt token<li>Host：域名<li>Connection：长链接keep-alive<li>Updrade-Insecure-Requests：升级为https请求<li>Content-Type:内容类型</ul><p>Response响应头：</p><ul><li>Set-Cookie：对方服务器设置cookie到用户浏览器的缓存<li>Retry-After：有时候服务器识别爬虫程序之后虽然正常返回响应数据，但是会给一个503状态码(服务器由于维护或者负载过重未能应答),让爬虫以为爬取失败</ul><p>所有的状态码都不可信，一切以是否从抓包得到的响应中获取到数据为准</p><p>network中抓包得到的源码才是判断依据，elements中的源码时渲染之后的源码，不能作为判断标准</p><p>http请求的过程</p><blockquote><ol><li>浏览器将域名发送给dns解析成对应的ip地址，拿到对应的ip地址后先向地址栏中的url发起请求，并获取响应<li>返回的响应内容html中，会有css,js,图片等url地址，以及ajax代码，浏览器会按照响应内容中的顺序依次发送其他的请求，并获取相应的响应<li>浏览器每获取一个响应就对展示出的结果进行添加(加载)，js,css等内容会修改页面的内容，js也可以重新发送请求，获取响应<li>从获取第一个响应并在浏览器中展示，直到最终获取全部响应，并在展示的结果中添加内容或修改—-这个过程叫做浏览器的渲染</ol></blockquote><h1 id="requests库">requests库</h1><h2 id="基本方法">基本方法</h2><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="n">requests</span><span class="p">.</span><span class="n">request</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="n">requests</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="n">requests</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="n">requests</span><span class="p">.</span><span class="n">patch</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="n">requests</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></table></code></div></div><ul><li>method：请求方式，有GET，HEAD， POST， PUT, PATCH, delete, OPTIONS。传参的时候以字符串写，各个方法的名字分别对应于http请求的对应请求方式<li>url：要请求的网址<li>**kwargs:控制访问参数，如下：</ul><blockquote><p>params：字典或字节序列，作为参数增加到url中.对应于查询字符串参数 data：字典/字节序列或文件对象形式，对应于请求体传参 json：json格式的数据 headers：字典，http请求头信息 cookies：字典或cookie Jar auth：元组，支持http认证功能 files：字典类型，传输文件 timeout：设定超时时间，以秒为单位,规定时间内没有响应就会报错 proxies：字典类型，设定访问代理服务器，可以增加登录认证 allow_redirects：True/False，默认位True，重定向开关 strea：True/False，默认True，获取内容立即下载开关 verify：True/False,默认True,认证SSL证书开关。设置为False时可以忽略CA证书的认证 cert：本地SSL证书路径</p></blockquote><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"http"</span><span class="p">:</span> <span class="s">"http://1.1.1.1:8888"</span><span class="p">,</span>
    <span class="s">"https"</span><span class="p">:</span> <span class="s">"http://1.1.1.1:8888"</span><span class="p">,</span>  <span class="c1"># 代理按协议分为http代理，https代理，socks代理
</span><span class="p">}</span>
<span class="n">代理使用成功不会有任何报错</span><span class="err">，</span><span class="n">能成功获取响应</span><span class="err">；</span><span class="n">如果失败</span><span class="err">，</span><span class="n">要么程序一直卡滞要么报错</span>      
</pre></table></code></div></div><p>关于post请求的表单数据来源：</p><ol><li>固定值：抓包比较不变值<li>输入值：抓包比较根据自身变化值<li>预设值-静态文件：需要提前从html静态文件中获取<li>预设值-发请求：需要对指定地址发请求以获取<li>在客户端生成的：分析js代码，模拟生成数据</ol><h2 id="requestssession">requests.session</h2><p>该类能够自动处理发送请求获取响应过程中产生的cookie，进而达到状态保持的目的</p><p>requests.session自动处理cookie，下一次请求会带上前一次的cookie。session实例在请求了一个网站后，对方服务器设置在本地的cookie会保存再session中，下一次请求的时候会自动带上</p><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">session</span><span class="p">()</span>  <span class="c1"># 实例化session对象
</span><span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="p">...)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="p">...)</span>
</pre></table></code></div></div><h2 id="requests库的异常">requests库的异常</h2><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="n">requests</span><span class="p">.</span><span class="nb">ConnectionError</span>  <span class="n">网络连接错误异常</span><span class="err">，</span><span class="n">如DNS查询失败</span><span class="err">，</span><span class="n">拒绝连接</span>
<span class="n">requests</span><span class="p">.</span><span class="n">HTTPError</span>  <span class="n">HTTP错误异常</span>
<span class="n">requests</span><span class="p">.</span><span class="n">URLRequired</span>  <span class="n">URL缺失异常</span>
<span class="n">requests</span><span class="p">.</span><span class="n">TooManyRedirects</span>  <span class="n">超过最大重定向次数</span><span class="err">，</span><span class="n">产生重定向异常</span>
<span class="n">requests</span><span class="p">.</span><span class="n">ConnectTimeout</span>  <span class="n">连接远程服务器超时异常</span>
<span class="n">requests</span><span class="p">.</span><span class="n">Timeout</span>  <span class="n">请求url超时</span><span class="err">，</span><span class="n">产生超时异常</span>
</pre></table></code></div></div><h2 id="response对象">Response对象</h2><ul><li><p>response.text是str类型，requests模块按照chardet模块推测出的编码字符集进行解码的结果</p><li>response.content是bytes类型，解码没有指定，可以自行指定，response.text = response.content.decode(“推测出的编码字符集”)<li>response.encoding获取根据头部信息推测出来的编码格式，可以自行赋值指定response对象的编码格式<li>response.url:响应的url，有时候响应的url和请求的url并不一致<li>response.status_code:响应状态码<li>response.request.headers:响应对应的请求头，返回一个字典<li>response.headers:响应头<li>response.request._cookies:响应对应请求的cookie；返回cookieJar类型<li>response.cookies：响应的cookie(经过了set-cookie动作；返回cookieJar类型)<li>response.json():自动将json字符串类型的响应内容转换为python对象(dict或者list)</ul><h2 id="代理请求">代理请求</h2><p>透明代理：透明代理可以直接隐藏浏览器的ip地址(你的ip)，但是还是可以查到你是谁。</p><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">目标服务器接收到的请求头</span><span class="err">：</span>
<span class="n">REMOTE_ADDR</span> <span class="o">=</span> <span class="n">代理ip</span>
<span class="n">HTTP_VIA</span> <span class="o">=</span> <span class="n">代理ip</span>
<span class="n">HTTP_X_FORWARDED_FOR</span> <span class="o">=</span> <span class="n">浏览器的ip</span><span class="p">(</span><span class="n">你的ip</span><span class="p">)</span>
</pre></table></code></div></div><p>匿名代理：别人只能知道你用了代理，无法知道你是谁。</p><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">REMOTE_ADDR</span> <span class="o">=</span> <span class="n">代理ip</span>
<span class="n">HTTP_VIA</span> <span class="o">=</span> <span class="n">代理ip</span>
<span class="n">HTTP_X_FORWARDED_FOR</span> <span class="o">=</span> <span class="n">代理ip</span>
</pre></table></code></div></div><p>高匿代理：别人无法发现你是在用代理。毫无疑问使用高匿代理效果最好</p><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">REMOTE_ADDR</span> <span class="o">=</span> <span class="n">代理ip</span>
<span class="n">HTTP_VIA</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">determined</span>
<span class="n">HTTP_X_FORWARDED_FOR</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">determined</span>
</pre></table></code></div></div><h2 id="网络爬虫的限制">网络爬虫的限制</h2><p>来源审查：判断User-Agent进行限制，检查来访http协议头的user-agent阈，只响应浏览器或友好爬虫的访问</p><p>发布公告：Robots协议，告知所有爬虫网站的爬取策略，要求爬虫遵守</p><p>Robots协议：Robots Exclusion Standard，网络爬虫排除标准。作用，网站告知网路爬虫哪些页面可以抓取，哪些不行；形式，在网站根目录瞎的robots.txt文件</p><h1 id="数据提取">数据提取</h1><h2 id="xml和html">xml和html</h2><div class="table-wrapper"><table><thead><tr><th>数据格式<th>描述<th>设计目标<tbody><tr><td>XML<td>Extensible Markup Language可扩展标记语言<td>被设计为传输和存储数据，其焦点是数据的内容<tr><td>HTML<td>HyperText Markup Language超文本标记语言<td>显示数据以及如何更好的显示数据</table></div><h2 id="jsonpath模块">jsonpath模块</h2><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">jsonpath</span> <span class="kn">import</span> <span class="n">jsonpath</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">jsonpath</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s">'jsonpath语法规则字符串'</span><span class="p">)</span>
</pre></table></code></div></div><div class="table-wrapper"><table><thead><tr><th>JsonPath<th>描述<tbody><tr><td>$<td>根节点<tr><td>@<td>现行节点<tr><td>. 或 []<td>取子节点<tr><td>..<td>就是不管位置，选择所有符合条件的元素<tr><td>*<td>匹配所有元素节点<tr><td>[]<td>迭代器标示（可以做取下标操作）<tr><td>[,]<td>迭代器多选，放入多个下标<tr><td>?()<td>过滤操作<tr><td>()<td>表达式计算</table></div><h2 id="lxml模块">LXML模块</h2><p>lxml模块可以利用XPath规则语法，来快速的定位HTML\XML 文档中特定元素以及获取节点信息（文本内容、属性值）</p><p>XPath (XML Path Language) 是一门在 HTML\XML 文档中查找信息的<strong>语言</strong>，可用来在 HTML\XML 文档中对<strong>元素和属性进行遍历</strong></p><ul><li>XPath语法参考：http://www.w3school.com.cn/xpath/index.asp</ul><div class="table-wrapper"><table><thead><tr><th>表达式<th>描述<tbody><tr><td>nodename<td>选中该元素。<tr><td>/<td>从根节点选取、或者是元素和元素间的过渡。<tr><td>//<td>从匹配选择的当前节点选择文档中的节点，而不考虑它们的位置。<tr><td>.<td>选取当前节点。<tr><td>..<td>选取当前节点的父节点。<tr><td>@<td>选取属性。<tr><td>text()<td>选取文本。<tr><td>//*[starts-with(@attribute,’xxx’)]<td>属性以xxx开头的元素<tr><td>//*[contains(@attribute,’Sxxx’)]<td>属性中含有xxx的元素</table></div><h2 id="beautifulsoup模块">BeautifulSoup模块</h2><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="n">html</span> <span class="o">=</span> <span class="s">"""
&lt;html&gt;&lt;head&gt;&lt;title&gt;The Dormouse's story&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;p class ="title" name="dromouse"&gt;&lt;b&gt;The Dormouse's story&lt;/b&gt;&lt;/p&gt;
&lt;p class ="story"&gt; Once upon a time there were three little s isters; and their names were
&lt;a href ="http://example.com/elsie" class="sister" id="linkl"&gt;&lt;!-Elsie … &gt;&lt; la&gt;,
&lt;a href ="http://example.com/lacie" class="sister" id="link2"&gt;Lacie&lt;/a&gt;and
&lt;a href="http://example.com/tillie" class="sister" id="link3"&gt;Tillie&lt;/a&gt;;
and they lived at the bottom of a well. &lt;/p&gt;
&lt;p class =" story "&gt; ... &lt;/p&gt;
"""</span>

<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s">'lxml'</span><span class="p">)</span>  <span class="c1"># 第一个参数是需要解析的html文本字符串，第二个参数是bs支持的解析器。选用lxml比较好
</span>
<span class="n">soup</span><span class="p">.</span><span class="n">title</span>  <span class="c1"># 选取title节点
</span><span class="n">soup</span><span class="p">.</span><span class="n">title</span><span class="p">.</span><span class="n">string</span>  <span class="c1"># 选取节点的文本信息
</span><span class="n">soup</span><span class="p">.</span><span class="n">title</span><span class="p">.</span><span class="n">name</span>  <span class="c1"># 获取节点的名称
</span><span class="n">soup</span><span class="p">.</span><span class="n">title</span><span class="p">.</span><span class="n">sttrs</span>  <span class="c1"># 获取节点的属性值，返回一个字典
</span>
<span class="c1"># 嵌套选择
</span><span class="n">soup</span><span class="p">.</span><span class="n">head</span><span class="p">.</span><span class="n">title</span>  <span class="c1"># 获取head标签下的title标签
</span>
<span class="c1"># 获取直接子节点
</span><span class="n">soup</span><span class="p">.</span><span class="n">p</span><span class="p">.</span><span class="n">contents</span>  <span class="c1"># 返回列表，包含p节点内的所有直接子节点
</span><span class="n">soup</span><span class="p">.</span><span class="n">p</span><span class="p">.</span><span class="n">children</span>  <span class="c1"># 返回生成器
</span>
<span class="c1"># 获取所有的子孙节点
</span><span class="n">soup</span><span class="p">.</span><span class="n">p</span><span class="p">.</span><span class="n">descendants</span>  <span class="c1"># 返回生成器，包含p标签内的所有子孙节点
</span>
<span class="c1"># 父节点
</span><span class="n">soup</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">parent</span>
<span class="c1"># 祖先节点
</span><span class="n">soup</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">parents</span>

<span class="c1"># 兄弟节点
</span><span class="n">soup</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">next_sibling</span>  <span class="c1"># 后一个兄弟节点
</span><span class="n">soup</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">previous_sibling</span> <span class="c1"># 前一个兄弟节点
</span><span class="n">soup</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">next_siblings</span>  <span class="c1"># 后面的兄弟节点们
</span><span class="n">soup</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">previous_siblings</span>  <span class="c1"># 前面的兄弟节点
</span>
<span class="c1"># find_all()  # 寻找符合的标签，返回符合条件的元素，是一个列表
</span><span class="n">find_all</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">recursive</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
	<span class="n">name</span><span class="p">:</span><span class="n">节点名称</span>
    <span class="n">attrs</span><span class="p">:</span><span class="n">节点属性值</span><span class="err">，</span><span class="n">字典类型</span>
    <span class="n">text</span><span class="p">:</span><span class="n">匹配节点的文本</span><span class="err">，</span><span class="n">字符串或者正则表达式对象</span>
     
<span class="c1"># find()  返回第一个匹配的元素    
# fing_parents()  返回所有祖先节点
# fing_parent()  返回直接父节点
# find_next_siblings()  返回后面的所有的兄弟节点
# find_next_sibling()  返回后面第一个兄弟节点
# find_previous_siblings()
# find_previous_sibling()
# find_all_next()  # 返回节点后所有符合条件的节点
# find_next()  # 返回符合条件的节点后边的第一个节点
# find_all_previous()
# find_previous()
</span></pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/'>网络爬虫</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/" class="post-tag no-text-decoration" >网络爬虫</a> <a href="/tags/requests/" class="post-tag no-text-decoration" >requests</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=爬虫与requests库 - 图样图森破&url=https://justzxy.cn/posts/python-spider/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=爬虫与requests库 - 图样图森破&u=https://justzxy.cn/posts/python-spider/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=爬虫与requests库 - 图样图森破&url=https://justzxy.cn/posts/python-spider/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/js/">JavaScript基础整理</a><li><a href="/posts/http-code/">HTTP 响应码</a><li><a href="/posts/pip/">python包管理工具pip</a><li><a href="/posts/pyecharts-pie/">pyecharts饼图使用笔记</a><li><a href="/posts/redis-fast/">Redis为什么这么快</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/python%E6%A0%87%E5%87%86%E5%BA%93/">Python标准库</a> <a class="post-tag" href="/tags/web%E5%BC%80%E5%8F%91%E6%8A%80%E6%9C%AF/">Web开发技术</a> <a class="post-tag" href="/tags/python%E8%BF%9B%E9%98%B6/">Python进阶</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/">计算机基础</a> <a class="post-tag" href="/tags/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">环境配置</a> <a class="post-tag" href="/tags/django/">Django</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/python%E5%9F%BA%E7%A1%80/">Python基础</a> <a class="post-tag" href="/tags/redis/">Redis</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/http-summary/"><div class="card-body"> <span class="timeago small" > Jul 20 <i class="unloaded">2021-07-20T11:37:41+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTTP概述</h3><div class="text-muted small"><p> HTTP 协议的介绍 HTTP 协议的全称是(HyperText Transfer Protocol)，翻译过来就是超文本传输协议。它规定了浏览器和 Web 服务器通信数据的格式，也就是说浏览器和web服务器通信需要使用http协议。 传输 HTTP 协议格式的数据是基于 TCP 传输协议的，发送数据之前需要先建立连接。 URL的概念 URL的英文全拼是(Uniform Resoure...</p></div></div></a></div><div class="card"> <a href="/posts/pgsql/"><div class="card-body"> <span class="timeago small" > Jul 19 <i class="unloaded">2021-07-19T22:03:41+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>PostgreSQL常用命令</h3><div class="text-muted small"><p> 一、PostgreSQL与MySQL常用命令的区别 语句 PostgreSQL MySQL 登录数据库 psql -U postgres -W mysql -uroot -p 查看数据库列表 \list或者\l s...</p></div></div></a></div><div class="card"> <a href="/posts/re-express/"><div class="card-body"> <span class="timeago small" > Jul 19 <i class="unloaded">2021-07-19T21:44:02+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>常用正则表达式</h3><div class="text-muted small"><p> 邮箱 example-123@gmail.com 只允许英文字母、数字、下划线、英文句号、以及中划线组成 ^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$ 你好001Abc@abcdef.com.cn 名称允许汉字、字母、数字，域名只允许英文域名 ^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/virtualenv/" class="btn btn-outline-primary" prompt="Older"><p>虚拟环境</p></a> <a href="/posts/celery-rabbitmq/" class="btn btn-outline-primary" prompt="Newer"><p>Celery与RabbitMQ</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 tooYoungtooSimple. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/python%E6%A0%87%E5%87%86%E5%BA%93/">Python标准库</a> <a class="post-tag" href="/tags/web%E5%BC%80%E5%8F%91%E6%8A%80%E6%9C%AF/">Web开发技术</a> <a class="post-tag" href="/tags/python%E8%BF%9B%E9%98%B6/">Python进阶</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/">计算机基础</a> <a class="post-tag" href="/tags/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">环境配置</a> <a class="post-tag" href="/tags/django/">Django</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/python%E5%9F%BA%E7%A1%80/">Python基础</a> <a class="post-tag" href="/tags/redis/">Redis</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://justzxy.cn{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script>
