<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Django基础" /><meta property="og:locale" content="en_US" /><meta name="description" content="Web框架的意义" /><meta property="og:description" content="Web框架的意义" /><link rel="canonical" href="https://justzxy.cn/posts/django-note/" /><meta property="og:url" content="https://justzxy.cn/posts/django-note/" /><meta property="og:site_name" content="图样图森破" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-01-06T19:14:46+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Django基础" /><meta name="twitter:site" content="@" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"Web框架的意义","url":"https://justzxy.cn/posts/django-note/","headline":"Django基础","dateModified":"2021-07-19T23:50:50+08:00","datePublished":"2019-01-06T19:14:46+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://justzxy.cn/posts/django-note/"},"@type":"BlogPosting","@context":"https://schema.org"}</script><title>Django基础 | 图样图森破</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="图样图森破"><meta name="application-name" content="图样图森破"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">图样图森破</a></div><div class="site-subtitle font-italic">Too Young Too Simple</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Django基础</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Django基础</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> tooYoungtooSimple </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Jan 6, 2019, 7:14 PM +0800" prep="on" > Jan 6, 2019 <i class="unloaded">2019-01-06T19:14:46+08:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, Jul 19, 2021, 11:50 PM +0800" prefix="Updated " > Jul 19 <i class="unloaded">2021-07-19T23:50:50+08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="6683 words">37 min</span></div></div><div class="post-content"><p>Web框架的意义</p><ul><li>用于搭建web应用程序<li>免去不同 Web 应用相同代码部分的重复编写，只需关心 Web 应用核心的业务逻辑实现</ul><p>Web应用程序的本质</p><ul><li>接收并解析 HTTP 请求 ，获取具体的请求信息<li>处理本次 HTTP 请求 ，即完成本次请求的业务逻辑处理<li>构造并返回处理结果 —— HTTP 响应</ul><h1 id="1django介绍">1.Django介绍</h1><ul><li>Django 是一款重量级框架, 内部架构使用的是 MVT 设计模式. 对比 Flask 框架，Django 原生提供了众多的功能组件，让开发更简便快速。<li>提供项目工程管理的自动化脚本工具( 脚手架工具 )<li>数据库 ORM 支持（对象关系映射，英语：Object Relational Mapping）<li>模板<li>表单<li>Admin 管理站点<li>文件管理<li>认证权限<li>session 机制<li>缓存</ul><p><strong>MVC 模式说明</strong></p><ul><li>M 全拼为 Model，主要封装对数据库层的访问，对数据库中的数据进行增、删、改、查操作。<li>V 全拼为 View，用于封装结果，生成页面展示的 html 内容。<li>C 全拼为 Controller，用于接收请求，处理业务逻辑，与 Model 和 View 交互，返回结果。</ul><p><strong>MVT 模式说明</strong></p><ul><li>M 全拼为 Model，与 MVC 中的 M 功能相同，负责和数据库交互，进行数据处理。<li>V 全拼为 View，与 MVC 中的 C 功能相同，接收请求，进行业务处理，返回应答。<li>T 全拼为 Template，与 MVC 中的 V 功能相同，负责封装构造要返回的 html。</ul><p>两种程序设计模式，其核心思想是分工, 解耦，让不同的代码块之间降低耦合，增强代码的可扩展性和可移植性，实现向后兼容。</p><h1 id="2工程搭建">2.工程搭建</h1><h2 id="21环境安装">2.1.环境安装</h2><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>创建虚拟环境	mkvirtualenv 环境名 -p python3

删除虚拟环境	rmvirtualenv 环境名

进入虚拟环境、查看所有虚拟环境	workon

退出虚拟环境	deactivate

安装Django	pip install django==版本

pip相关命令：
	查看：pip list/freeze
</pre></table></code></div></div><h2 id="22创建工程">2.2.创建工程</h2><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>	<span class="n">创建项目工程</span>	<span class="n">django</span><span class="o">-</span><span class="n">admin</span> <span class="n">startproject</span> <span class="n">工程名称</span>

	<span class="n">django提供了一个轻量级web服务器供开发阶段使用</span><span class="err">，</span><span class="n">运行命令</span><span class="err">：</span>
	<span class="n">python</span> <span class="n">manage</span><span class="p">.</span><span class="n">py</span> <span class="n">runserver</span>
	<span class="c1"># 默认运行在 127.0.0.1:8000 的 IP 和 端口上
</span>	<span class="c1"># 我们也可以在刚刚的命令后面增加 IP:PORT 参数, 指定特定的 IP 和 端口号运行:
</span>	<span class="n">python</span> <span class="n">manage</span><span class="p">.</span><span class="n">py</span> <span class="n">runserver</span> <span class="n">IP地址</span><span class="p">:</span><span class="n">端口</span>
</pre></table></code></div></div><h2 id="23创建子应用">2.3.创建子应用</h2><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c1"># 创建子应用的常见命令: 
</span>	<span class="n">python</span> <span class="n">manage</span><span class="p">.</span><span class="n">py</span> <span class="n">startapp</span> <span class="n">子应用名称</span>

	<span class="n">创建子应用完成后</span><span class="err">，</span><span class="n">在项目工程的</span> <span class="n">settings</span><span class="p">.</span><span class="n">py</span> <span class="n">文件中进行注册配置</span><span class="err">，</span> <span class="n">将子应用的配置信息文件</span> <span class="n">apps</span><span class="p">.</span><span class="n">py</span> <span class="n">中的</span> <span class="n">Config</span> <span class="n">类添加到</span> <span class="n">INSTALLED_APPS</span> <span class="n">列表中</span><span class="err">。</span>
	<span class="o">-</span> <span class="n">例如</span><span class="err">：</span><span class="n">users</span><span class="p">.</span><span class="n">apps</span><span class="p">.</span><span class="n">UsersConfig</span> 
</pre></table></code></div></div><h2 id="24创建视图">2.4.创建视图</h2><ul><li><p>在子应用的views.py编写视图代码<br /> 视图函数的第一个传入参数必须定义，用于接收 Django 构造的包含了请求数据的 HttpReqeust 对象，通常名为 request。</p><p>视图函数的返回值必须为一个响应对象, 可以将要返回的字符串数据放到一个 HTTPResponse 对象中。</p><li><p>定义路由url<br /> 在子应用中新建一个 urls.py 文件保存该应用的路由<br /> 在 users / urls.py 文件中定义路由信息<br /> 在工程总路由 urls.py 中添加子应用的路由数据</p></ul><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="o">---</span><span class="n">子路由</span><span class="err">：</span><span class="n">urlpattern</span> <span class="o">=</span> <span class="p">[</span>
	<span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s">'^index/$'</span><span class="p">,</span> <span class="n">views</span><span class="p">.</span><span class="n">index</span><span class="p">)</span>
<span class="p">]</span>
	<span class="o">---</span><span class="n">总路由</span><span class="err">：</span><span class="n">urlpattern</span> <span class="o">=</span> <span class="p">[</span>
	<span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s">'^users/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">'users.urls'</span><span class="p">))</span>
<span class="p">]</span>
    
<span class="n">使用</span> <span class="n">include</span> <span class="n">来将子应用</span> <span class="n">users</span> <span class="n">里的路由文件</span><span class="p">(</span> <span class="n">urls</span><span class="p">.</span><span class="n">py</span> <span class="p">)</span><span class="n">包含到工程总路由中</span> <span class="sa">r</span><span class="s">'^users/'</span> <span class="n">决定了</span> <span class="n">users</span> <span class="n">子应用的所有路由都以</span> <span class="o">/</span><span class="n">users</span><span class="o">/</span> <span class="n">开头</span><span class="err">，</span><span class="n">如我们刚定义的视图</span> <span class="n">index</span><span class="err">，</span> <span class="n">其最终的完整访问路径为</span> <span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">index</span><span class="o">/</span><span class="err">。</span>    
</pre></table></code></div></div><h1 id="3配置静态文件路由">3.配置/静态文件/路由</h1><h2 id="31配置文件">3.1.配置文件</h2><p>BASE_DIR</p><ul><li>指当前工程的根目录，Django 会依此来定位工程内的相关文件，我们也可以使用该参数来构造文件路径。<li>BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(<strong>file</strong>)))<li><strong><em>file</em></strong> : 可以理解为当前的文件<li>os.path.abspath ( 文件 ) : 获取这个文件的绝对路径<li>os.path.dirname( 路径 ) : 获取这个路径的上一级路径</ul><h2 id="32静态文件">3.2.静态文件</h2><p>一般把项目中前端写的 CSS、图片、js 以及 html 等看做静态文件 。</p><p>为了提供静态文件访问路径，我们需要在项目的 settings.py 文件中配置两个参数：</p><ul><li>STATICFILES_DIRS : 存放查找静态文件的目录<li>STATIC_URL : 访问静态文件的 URL 前缀</ul><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="mi">1</span><span class="err">）</span><span class="n">在项目根目录下创建</span> <span class="n">static_files</span> <span class="n">目录来保存静态文件</span><span class="err">。</span>
<span class="mi">2</span><span class="err">）</span><span class="n">在</span> <span class="n">demo</span> <span class="o">/</span> <span class="n">settings</span><span class="p">.</span><span class="n">py</span> <span class="n">中修改静态文件的两个参数为</span>
<span class="c1"># 这个参数默认存在
</span><span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s">'/static/'</span>
<span class="c1"># 我们可以添加这个参数, 用于补全静态文件路径
</span><span class="n">STATICFILES_DIRS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">'static_files'</span><span class="p">),</span>
<span class="p">]</span>
<span class="mi">3</span><span class="err">）</span><span class="n">此时在</span> <span class="n">static_files</span> <span class="n">添加的任何静态文件都可以使用网址</span> <span class="o">/</span><span class="n">static</span><span class="o">/</span> <span class="n">文件在</span> <span class="n">static_files</span> <span class="n">中的路径</span> <span class="n">来访问了</span><span class="err">。</span>
</pre></table></code></div></div><p>Django 仅在调试模式下（DEBUG=True）能对外提供静态文件。</p><p>当DEBUG=False工作在生产模式时，Django不再对外提供静态文件，需要是用collectstatic命令来收集静态文件并交由其他静态文件服务器来提供。</p><h2 id="33路由说明">3.3.路由说明</h2><p>http://www.baidu.com:80/users/index/?a=1&amp;b=2&amp;c=3#box</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>http:// 代表使用的协议
www.baidu.com 指的是访问的域名
80 指的是调用的端口
/users/index/ 指的是路由部分
?a=1&amp;b=2&amp;c=3 指的是查询字符串
#box 指的是锚点
</pre></table></code></div></div><p><strong>路由解析顺序</strong> Django 在接收到一个请求时，从主路由文件中的 urlpatterns 列表中以由上至下的顺序查找对应路由规则，如果发现规则为 include 包含，则再进入被包含的 urls 中的 urlpatterns 列表由上至下进行查询。有可能会使上面的路由屏蔽掉下面的路由，带来非预期结果。</p><p><strong>路由命名</strong></p><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="mi">1</span><span class="p">)</span> <span class="n">在使用</span> <span class="n">include</span> <span class="n">函数定义路由时</span><span class="err">，</span><span class="n">可以使用</span> <span class="n">namespace</span> <span class="n">参数定义路由的命名空间</span>
	<span class="o">-</span> <span class="n">include</span><span class="p">(</span><span class="s">'子应用.urls'</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s">"名称"</span> <span class="p">)</span>
<span class="mi">2</span><span class="p">)</span> <span class="n">在定义普通路由时</span><span class="err">，</span><span class="n">可以使用</span> <span class="n">name</span> <span class="n">参数指明路由的名字</span>
	<span class="o">-</span> <span class="n">url</span><span class="p">(</span><span class="s">'正则'</span><span class="p">,</span> <span class="n">视图函数</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">"名称"</span><span class="p">)</span>
</pre></table></code></div></div><p><strong>reverse 反解析</strong></p><p>可以根据路由名称，返回具体的路径： reverse( ‘总路由名称 : 子路由名称’ )</p><p>路径中的 / 代表路径分隔符, 一般我们发请求时最好携带.</p><p>如果发请求时, 没有在最后携带 / , 则浏览器会帮我们进行一次重定向, 再次访问携带 / 的路径</p><h1 id="4请求与响应">4.请求与响应</h1><h2 id="41请求request">4.1.请求Request</h2><p>QueryDict 对象是 django 中一种特殊类型的字典，可以存储 一对一类型的数据, 也可以存储 一对多类型的数据，一般用来存储浏览器传递过来的参数，可以默认把他看成是一个字典</p><p>获取 QueryDict 中的数据:</p><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="o">-</span> <span class="n">一键</span> <span class="o">===&gt;</span> <span class="n">一值</span><span class="p">:</span> <span class="n">QueryDict</span> <span class="n">这个字典可以调用</span> <span class="n">get</span><span class="p">(</span> <span class="p">)</span> <span class="n">函数来获取</span><span class="p">.</span>
<span class="o">-</span> <span class="n">一键</span> <span class="o">===&gt;</span> <span class="n">多值</span><span class="p">:</span> <span class="n">QueryDict</span> <span class="n">这个字典的获取方法</span><span class="p">:</span>
		<span class="n">如果获取一个值</span><span class="p">:</span> <span class="n">QueryDict</span><span class="p">.</span><span class="n">get</span><span class="p">(</span> <span class="n">key</span> <span class="p">)</span> <span class="n">获取的是所有值的最后一个</span><span class="p">.</span>
		<span class="n">如果获取多个值</span><span class="p">:</span> <span class="n">QueryDict</span><span class="p">.</span><span class="n">getlist</span><span class="p">(</span> <span class="n">key</span> <span class="p">)</span> <span class="n">获取这个键对应的所有值</span><span class="p">,</span> <span class="n">存放在列表中返回</span><span class="p">.</span><span class="n">得到的值都是字符串类型</span>
</pre></table></code></div></div><p>前端传参的四种方式：</p><p>1、查询字符串QueryString 传参，通过url的参数部分传参，取值：request.GET.get(‘key’)</p><ul><li>通过 request.GET 获取的是 QueryDict 类型<li>通过 QueryDict 的 get( ) 和 getlist( ) 方法来获取某个键对应的数据<li>通过QueryDict的dict()方法获取所有的kv查询参数</ul><p>2、路径传参，url/(分组1正则式)/(分组2正则式)，取值：视图函数定义形参接收，若未对正则式进行命名，则安定依顺序传递给形参</p><p>3、请求体传参，可以发送请求体数据的请求方式有 POST、PUT、PATCH、DELETE。</p><p>表单类型参数：通过 request.POST 属性获取，返回 QueryDict 对象，通过 QueryDict 的 get( ) 和 getlist( ) 函数, 获取数据</p><p>非表单类型参数：通过 request.body 属性获取最原始的请求体数据，返回 bytes 类型</p><p>请求对象中的请求头信息：</p><ul><li>获取请求头数据可以通过 request.META 属性获取请求头中的数据 request.META 为字典类型<li>具体使用 request.META[‘CONTENT_LENGTH’]</ul><p>请求对象中的其他信息：</p><ul><li>request.属性名，user/method/path/FILES/encoding</ul><h2 id="42响应response">4.2.响应Response</h2><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>	<span class="n">HttpResponse的三个参数</span><span class="err">：</span>
	<span class="n">HttpResponse</span><span class="p">(</span>
    <span class="n">content</span><span class="o">=</span><span class="n">响应体</span><span class="p">,</span> 
    <span class="n">content_type</span><span class="o">=</span><span class="n">响应体数据类型</span><span class="p">,</span> 
    <span class="n">status</span><span class="o">=</span><span class="n">状态码</span>
<span class="p">)</span>
    
<span class="n">如果需要在响应头添加自定义的键值对内容</span><span class="p">,</span><span class="n">可以把</span> <span class="n">HttpResponse</span> <span class="n">对象当做字典进行响应头键值对的设置</span><span class="err">：</span>
<span class="c1"># 创建一个 response 对象
</span><span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">()</span>
<span class="c1"># 在对象中添加一个新的 键值对
</span><span class="n">response</span><span class="p">[</span><span class="s">'Itcast'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'Python'</span>

<span class="n">JsonResponse</span> <span class="n">类</span>
	<span class="o">-</span> <span class="n">帮助我们将字典数据转换为</span> <span class="n">json</span> <span class="n">字符串</span>
	<span class="o">-</span> <span class="n">设置响应头</span> <span class="n">Content</span><span class="o">-</span><span class="n">Type</span> <span class="n">为</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
    
<span class="n">redirect</span> <span class="n">重定向</span>
	<span class="o">-</span> <span class="n">使用格式</span><span class="p">:</span><span class="n">redirect</span><span class="p">(</span><span class="s">'想要跳转的路径'</span><span class="p">)</span><span class="err">，</span><span class="n">一般搭配reverse使用</span>  
</pre></table></code></div></div><h2 id="43cookie">4.3.Cookie</h2><p>指的是由服务端生成, 保存在客户端的一种数据存储形式, 内部以 key/value 键值对形式存储. 一般不存储敏感信息. 内容有时会被加密.</p><p>Cookie 的特点</p><ul><li>Cookie 以键值对 Key-Value 形势进行信息的存储<li>Cookie 基于域名安全，不同域名的 Cookie 是不能互相访问的</ul><p>设置Cookie</p><ul><li>通过 HttpResponse 对象中的 set_cookie 方法来设置 cookie。</ul><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">response</span><span class="p">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="n">key</span><span class="p">,</span>  <span class="n">value</span><span class="p">,</span>  <span class="n">max_age</span><span class="p">)</span>
<span class="o">-</span> <span class="n">max_age</span> <span class="n">单位为秒</span><span class="p">,</span> <span class="n">默认为</span> <span class="bp">None</span><span class="p">.</span> <span class="n">如果设置</span> <span class="bp">None</span> <span class="n">值</span><span class="p">,</span> <span class="n">则关闭浏览器失效</span><span class="p">.</span>
</pre></table></code></div></div><p>读取Cookie</p><ul><li>通过 HttpRequest 对象( request )的 COOKIES 属性来读取本次请求携带的 cookie 值。request.COOKIES 为字典类型</ul><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">value</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">COOKIES</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'key'</span><span class="p">)</span>
</pre></table></code></div></div><p>删除Cookie</p><ul><li>删除的服务器的,游览器的还是没有删掉<code class="language-plaintext highlighter-rouge">del request.COOKIES['my']</code><li>cookie对应的值删了,键还是存在的<code class="language-plaintext highlighter-rouge">response.delete_cookie('my')</code><li>这个是删除所有cookie<code class="language-plaintext highlighter-rouge">response.flush()</code></ul><h2 id="44session">4.4.Session</h2><p>Session 是一种会话控制方式. 由服务端创建, 并且保存在服务端的数据存储形式. 内部以 key/value 键值对的形式存储. 可以存储敏感信息, 内容有些会被加密. 一般生成 session 后, 我们会把 sessionid 传递给 cookie 保存.</p><p>Session 的作用</p><ul><li>在服务器上保存用户状态信息, 以供前端页面访问<li>因为数据保存在服务器端, 所以可以保存敏感信息. 每次前端发送请求, 可以随时获取对应的信息. 保持会话状态</ul><p>Session 的特点</p><ul><li>依赖 cookies<li>存储敏感、重要的信息<li>支持更多字节<li>Session 共享问题</ul><p>Session 配置和存储</p><p>settings.py 文件中，可以设置 session 数据的存储方式:</p><ul><li>数据库：默认存储方式，SESSION_ENGINE=’django.contrib.sessions.backends.db’<li>本地缓存：存储在本机内存中，如果丢失则不能找回，比数据库的方式读写更快SESSION_ENGINE=’django.contrib.sessions.backends.cache’<li>混合存储：优先从本机内存中存取，如果没有则从数据库中存取。SESSION_ENGINE=’django.contrib.sessions.backends.cached_db’</ul><p>在 redis 中保存 session，需要引入第三方扩展，我们可以使用 django-redis 来解决。</p><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="mi">1</span><span class="err">）</span><span class="n">安装扩展</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">django</span><span class="o">-</span><span class="n">redis</span>
<span class="mi">2</span><span class="err">）</span><span class="n">配置</span><span class="err">：</span><span class="n">settings</span><span class="p">.</span><span class="n">py</span> <span class="n">文件中</span>
<span class="n">CACHES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"default"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">"BACKEND"</span><span class="p">:</span> <span class="s">"django_redis.cache.RedisCache"</span><span class="p">,</span>
        <span class="s">"LOCATION"</span><span class="p">:</span> <span class="s">"redis://127.0.0.1:6379/1"</span><span class="p">,</span>
        <span class="s">"OPTIONS"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"CLIENT_CLASS"</span><span class="p">:</span> <span class="s">"django_redis.client.DefaultClient"</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">SESSION_ENGINE</span> <span class="o">=</span> <span class="s">"django.contrib.sessions.backends.cache"</span>
<span class="n">SESSION_CACHE_ALIAS</span> <span class="o">=</span> <span class="s">"default"</span>
</pre></table></code></div></div><p>Session 操作：</p><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="n">通过</span> <span class="n">HttpRequest</span> <span class="n">对象</span><span class="p">(</span> <span class="n">request</span> <span class="p">)</span> <span class="n">的</span> <span class="n">session</span> <span class="n">属性进行会话的读写操作</span><span class="err">。</span>
	<span class="mi">1</span><span class="err">）</span><span class="n">往</span> <span class="n">session</span> <span class="n">中写入键值对</span><span class="p">:</span>
		<span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">[</span><span class="s">'键'</span><span class="p">]</span> <span class="o">=</span> <span class="n">值</span>
	<span class="mi">2</span><span class="err">）</span><span class="n">根据</span> <span class="n">key</span> <span class="n">读取</span> <span class="n">session</span> <span class="n">中的数据</span><span class="p">:</span>
		<span class="n">value</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'键'</span><span class="p">,</span><span class="n">默认值</span><span class="p">)</span>
	<span class="mi">3</span><span class="err">）</span><span class="n">清除所有</span> <span class="n">session</span><span class="err">，</span><span class="n">在存储中删除值部分</span><span class="p">:</span>
		<span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
	<span class="mi">4</span><span class="err">）</span><span class="n">清除</span> <span class="n">session</span> <span class="n">数据</span><span class="err">，</span><span class="n">在存储中删除</span> <span class="n">session</span> <span class="n">的整条数据</span><span class="p">:</span>
		<span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">flush</span><span class="p">()</span>
	<span class="mi">5</span><span class="err">）</span><span class="n">删除</span> <span class="n">session</span> <span class="n">中的指定键及值</span><span class="err">，</span><span class="n">在存储中只删除某个键及对应的值</span><span class="err">。</span>
		<span class="k">del</span> <span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">[</span><span class="s">'键'</span><span class="p">]</span>
	<span class="mi">6</span><span class="err">）</span><span class="n">设置</span> <span class="n">session</span> <span class="n">的有效期</span>
		<span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">set_expiry</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
			<span class="o">-</span> <span class="n">如果</span> <span class="n">value</span> <span class="n">是一个整数</span><span class="err">，</span><span class="n">session</span> <span class="n">将在</span> <span class="n">value</span> <span class="n">秒没有活动后过期</span><span class="err">。</span>
			<span class="o">-</span> <span class="n">如果</span> <span class="n">value</span> <span class="n">为</span> <span class="mi">0</span><span class="err">，</span><span class="n">那么用户</span> <span class="n">session</span> <span class="n">的</span> <span class="n">Cookie</span> <span class="n">将在用户的浏览器关闭时过期</span><span class="err">。</span>
			<span class="o">-</span> <span class="n">如果</span> <span class="n">value</span> <span class="n">为</span> <span class="bp">None</span><span class="err">，</span><span class="n">那么</span> <span class="n">session</span> <span class="n">有效期将采用系统默认值</span><span class="err">，</span><span class="n">默认为两周</span><span class="err">，</span><span class="n">可以通过在</span> <span class="n">settings</span><span class="p">.</span><span class="n">py</span> <span class="n">中设置</span> <span class="n">SESSION_COOKIE_AGE</span> <span class="n">来设置全局默认值</span><span class="err">。</span>
</pre></table></code></div></div><h1 id="5类视图与中间件">5.类视图与中间件</h1><h2 id="51类视图">5.1.类视图</h2><p>定义类视图需要继承自 Django 提供的父类 View ，配置路由时，需要在类名后面增加 as_view( ) 函数，类视图中的函数名称是规定死的请求方法名</p><p>类视图添加装饰器–</p><ul><li>以下my_decorate维自定义的闭包装饰器</ul><p>1、在urls.py里在类视图的前面添加一个装饰器，my_decorate(views.RegisterView.as_view())–不推荐。此种方式会为类视图中的所有请求方法都加上装饰器行为</p><p>2、使用method_decorator</p><p>​ 1&gt; 在views.py的类视图上面添加@methos_decorator(my_decorate,name=”dispatch”)，为全部请求方法添加装饰器</p><p>​ 2&gt; 在views.py的类视图上面添加@methos_decorator(my_decorate,name=”get”)，为特定请求方法添加装饰器</p><p>​ 3&gt; 在views.py的类视图里对应的方法上面添加@methos_decorator(my_decorate)，为特定请求方法添加装饰器</p><p>类视图Mixin扩展类</p><p>使用 Mixin 扩展类时有两个注意点:<br /> 扩展类需要继承自 object<br /> 类视图调用时, 需要把 View 类添加到最后<br /> 在 Mixin 扩展类中, 我们一般会重写 as_view( ) 函数. 在函数内添加过滤<br /> 一个类视图可以继承多个扩展类, 每个扩展类中都可以添加装饰器.</p><h2 id="52中间件">5.2.中间件</h2><p>中间件是一个轻量级、底层的插件系统，可以介入请求和响应处理过程，在 Django 视图的不同阶段对输入或输出进行处理.</p><p>中间件的定义方法–</p><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">simple_middleware</span><span class="p">(</span><span class="n">get_response</span><span class="p">):</span>
    <span class="c1"># 此处编写的代码仅在 Django 第一次配置和初始化的时候执行一次。
</span>
    <span class="k">def</span> <span class="nf">middleware</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>

        <span class="c1"># 此处编写的代码会在每个请求处理视图前被调用。
</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">get_response</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="c1"># 此处编写的代码会在每个请求处理视图之后被调用。
</span>
        <span class="k">return</span> <span class="n">response</span>

    <span class="k">return</span> <span class="n">middleware</span>

<span class="n">定义好中间件后</span><span class="err">，</span><span class="n">需要在</span> <span class="n">settings</span><span class="p">.</span><span class="n">py</span> <span class="n">文件中添加注册中间件</span><span class="err">：</span>
	<span class="n">settings里MIDDLEWARE配置中间件</span><span class="err">，</span><span class="n">如</span><span class="s">'users.middleware.my_middleware'</span><span class="err">，</span>
    
<span class="n">注意</span><span class="err">：</span><span class="n">多个中间件的执行顺序</span><span class="err">，</span><span class="n">视图处理前和视图处理后的调用顺序不一致</span>
	<span class="o">-</span> <span class="n">在请求视图被处理前</span><span class="err">，</span><span class="n">中间件由上至下依次执行</span>
	<span class="o">-</span> <span class="n">在请求视图被处理后</span><span class="err">，</span><span class="n">中间件由下至上依次执行</span>
</pre></table></code></div></div><h1 id="6模板">6.模板</h1><h2 id="django模板">Django模板</h2><p>略</p><h2 id="csrf攻击">CSRF攻击</h2><p>定义：CSRF全拼为 Cross Site Request Forgery， 译为跨站请求伪造。CSRF指攻击者盗用了你的身份，以你的名义发送恶意请求。</p><p>防止 CSRF 攻击：</p><p>1、在客户端向后端请求界面数据的时候，后端会往响应中的 cookie 中设置 csrf_token 的值</p><p>2、在 Form 表单中添加一个隐藏的的字段，值也是 csrf_token</p><p>3、在用户点击提交的时候，会带上这两个值向后台发起请求</p><p>4、后端接受到请求，以会以下几件事件：</p><ul><li>从 cookie 中取出 csrf_token<li>从 表单数据中取出来隐藏的 csrf_token 的值<li>Django 进行对比 (这里的对比不要求一定一致, 有时候两个值不一致)</ul><p>5、如果对比能够通过, 则是正常的请求</p><p>6、如果对比不能够通过，代表不是正常的请求，不执行下一步操作</p><h1 id="7数据库">7.数据库</h1><p>ORM框架</p><ul><li>O是 object，也就类对象的意思<li>R 是 relation，翻译成中文是关系, 也就是关系数据库中数据表的意思.<li>M 是 mapping，是映射的意思</ul><p>通过类和类对象就能操作它所对应的表格中的数据;根据我们设计的类自动帮我们生成数据库中的表格</p><h2 id="71-配置">7.1. 配置</h2><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="n">默认使用sqlite</span>
	<span class="mi">1</span>\<span class="n">安装pip</span> <span class="n">install</span> <span class="n">PyMySQL</span>
	<span class="mi">2</span>\<span class="n">在</span> <span class="n">Django</span> <span class="n">的工程同名子目录的</span> <span class="n">__init__</span><span class="p">.</span><span class="n">py</span> <span class="n">文件中添加如下语句</span><span class="p">:</span>
	<span class="kn">from</span> <span class="nn">pymysql</span> <span class="kn">import</span> <span class="n">install_as_MySQLdb</span>
	<span class="n">install_as_MySQLdb</span><span class="p">()</span>
	<span class="mi">3</span>\<span class="n">修改</span> <span class="n">DATABASES</span> <span class="n">配置信息</span>
	<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">'default'</span><span class="p">:</span> <span class="p">{</span>
			<span class="s">'ENGINE'</span><span class="p">:</span> <span class="s">'django.db.backends.mysql'</span><span class="p">,</span>
			<span class="s">'HOST'</span><span class="p">:</span> <span class="s">'127.0.0.1'</span><span class="p">,</span>  <span class="c1"># 数据库主机
</span>			<span class="s">'PORT'</span><span class="p">:</span> <span class="mi">3306</span><span class="p">,</span>  <span class="c1"># 数据库端口
</span>			<span class="s">'USER'</span><span class="p">:</span> <span class="s">'root'</span><span class="p">,</span>  <span class="c1"># 数据库用户名
</span>			<span class="s">'PASSWORD'</span><span class="p">:</span> <span class="s">'mysql'</span><span class="p">,</span>  <span class="c1"># 数据库用户密码
</span>			<span class="s">'NAME'</span><span class="p">:</span> <span class="s">'django_demo'</span>  <span class="c1"># 数据库名字
</span>		<span class="p">}</span>
	<span class="p">}</span>
	<span class="mi">4</span>\<span class="n">在</span> <span class="n">MySQL</span> <span class="n">中创建数据库</span>
	<span class="n">create</span> <span class="n">database</span> <span class="n">django_demo</span> <span class="n">default</span> <span class="n">charset</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
</pre></table></code></div></div><h2 id="72定义模型类">7.2.定义模型类</h2><p>类中类可以定义abstract=True表示抽象类，不会在迁移的时候生成迁移文件，managed=False表示django只用这个模型类，但是不管理这个模型类</p><p>生成迁移文件：python manage.py makemigrations</p><p>迁移：python manage.py migrate</p><h2 id="74数据库操作">7.4.数据库操作</h2><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
</pre><td class="rouge-code"><pre><span class="o">-</span> <span class="n">增加</span>
	<span class="n">save</span>  <span class="n">通过创建模型类对象</span><span class="err">，</span><span class="n">执行对象的save</span><span class="p">()</span><span class="n">方法保存到数据库中</span>
	<span class="n">create</span>  <span class="n">通过</span> <span class="n">模型类</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">create</span><span class="p">()</span> <span class="n">保存</span><span class="p">.</span>

	<span class="o">-</span> <span class="n">删除</span>
	<span class="n">使用对象删除</span><span class="err">，</span><span class="n">对象</span><span class="p">.</span><span class="n">delete</span><span class="p">()</span>
	<span class="n">使用查询集删除</span><span class="err">，</span><span class="n">模型类</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">().</span><span class="n">delete</span><span class="p">()</span>

	<span class="o">-</span> <span class="n">修改</span>
	<span class="n">save</span>  <span class="n">修改模型类对象的属性</span><span class="err">，</span><span class="n">然后执行</span> <span class="n">save</span><span class="p">()</span> <span class="n">方法</span>
	<span class="n">update</span>  <span class="n">查询集</span><span class="p">.</span><span class="n">update</span><span class="p">()</span><span class="err">，</span><span class="n">使用</span> <span class="n">模型类</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">().</span><span class="n">update</span><span class="p">()</span><span class="err">，</span><span class="n">会返回受影响的行数</span>
		<span class="n">HeroInfo</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">hname</span><span class="o">=</span><span class="s">'沙悟净'</span><span class="p">).</span><span class="n">update</span><span class="p">(</span><span class="n">hname</span><span class="o">=</span><span class="s">'沙僧'</span><span class="p">)</span>

	<span class="o">-</span> <span class="n">查询</span>
	<span class="n">get</span> <span class="n">查询单一结果</span><span class="err">，</span><span class="n">如果不存在会抛出</span> <span class="n">模型类</span><span class="p">.</span><span class="n">DoesNotExist</span> <span class="n">异常</span><span class="p">.</span>
	<span class="nb">all</span> <span class="n">查询多个结果</span>
	<span class="n">count</span> <span class="n">查询结果数量</span>

	<span class="o">-</span> <span class="n">过滤查询</span>
	<span class="nb">filter</span> <span class="n">过滤出多个结果</span>
	<span class="n">exclude</span> <span class="n">排除掉符合条件剩下的结果</span>
	<span class="n">get</span> <span class="n">过滤单一结果</span>
	<span class="n">过滤条件的表达语法如下</span><span class="err">：</span><span class="n">属性名称__比较运算符</span> <span class="o">=</span> <span class="n">值</span>
		<span class="o">-</span> <span class="n">相等exact</span><span class="err">：</span><span class="n">表示判等</span>
			<span class="n">BookInfo</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">id__exact</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="o">-</span> <span class="n">模糊查询contains</span><span class="err">：</span><span class="n">是否包含</span><span class="err">，</span><span class="n">startswith</span><span class="err">、</span><span class="n">endswith</span><span class="err">：</span><span class="n">以指定值开头或结尾</span>
			<span class="n">BookInfo</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">btitle__contains</span><span class="o">=</span><span class="s">'传'</span><span class="p">)</span>
		<span class="n">以上运算符都区分大小写</span><span class="err">，</span><span class="n">在这些运算符前加上i表示不区分大小写</span><span class="err">，</span><span class="n">如iexact</span><span class="err">、</span><span class="n">icontains</span><span class="err">、</span><span class="n">istartswith</span><span class="err">、</span><span class="n">iendswith</span><span class="p">.</span>
		<span class="o">-</span> <span class="n">空查询isnull</span><span class="err">：</span><span class="n">是否为null</span>
			<span class="n">BookInfo</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">btitle__isnull</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
		<span class="o">-</span> <span class="n">范围查询in和range</span><span class="err">：</span><span class="n">是否包含在范围内</span>
			<span class="n">BookInfo</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">id__in</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
			<span class="n">Entry</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">pub_date__range</span><span class="o">=</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">))</span>
		<span class="o">-</span> <span class="n">比较查询gt</span> <span class="n">大于</span> <span class="p">(</span><span class="n">greater</span> <span class="n">then</span><span class="p">)</span><span class="err">，</span><span class="n">gte</span> <span class="n">大于等于</span> <span class="p">(</span><span class="n">greater</span> <span class="n">then</span> <span class="n">equal</span><span class="p">)</span><span class="err">，</span><span class="n">lt</span> <span class="n">小于</span> <span class="p">(</span><span class="n">less</span> <span class="n">then</span><span class="p">)</span><span class="err">，</span><span class="n">lte</span> <span class="n">小于等于</span> <span class="p">(</span><span class="n">less</span> <span class="n">then</span> <span class="n">equal</span><span class="p">)</span>
			<span class="n">BookInfo</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">id__gt</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
		<span class="o">-</span> <span class="n">日期查询year</span><span class="err">、</span><span class="n">month</span><span class="err">、</span><span class="n">day</span><span class="err">、</span><span class="n">week_day</span><span class="err">、</span><span class="n">hour</span><span class="err">、</span><span class="n">minute</span><span class="err">、</span><span class="n">second</span><span class="err">：</span><span class="n">对日期时间类型的属性进行运算</span>
			<span class="n">BookInfo</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">bpub_date__year</span><span class="o">=</span><span class="mi">1980</span><span class="p">)</span>


	<span class="o">-</span> <span class="n">F</span> <span class="n">对象</span> <span class="n">和</span> <span class="n">Q</span> <span class="n">对象</span>
	<span class="n">两个属性比较</span><span class="err">，</span><span class="n">使用</span> <span class="n">F对象</span><span class="err">：</span><span class="n">F</span><span class="p">(</span><span class="n">属性名</span><span class="p">)</span><span class="err">：</span>
		<span class="n">BookInfo</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">bread__gte</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">'bcomment'</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
	<span class="n">多个过滤器逐个调用表示</span> <span class="n">逻辑与</span> <span class="n">关系</span><span class="err">：</span>
		<span class="n">BookInfo</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">bread__gt</span><span class="o">=</span><span class="mi">20</span><span class="p">).</span><span class="nb">filter</span><span class="p">(</span><span class="n">id__lt</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
	<span class="n">使用</span> <span class="n">Q</span><span class="p">(</span> <span class="p">)</span> <span class="n">对象结合</span><span class="o">|</span><span class="n">运算符实现</span> <span class="n">逻辑或</span><span class="p">(</span><span class="ow">or</span><span class="p">)</span> <span class="n">的查询</span><span class="err">：</span>
		<span class="n">BookInfo</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">bread__gt</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="o">|</span> <span class="n">Q</span><span class="p">(</span><span class="n">pk__lt</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
		<span class="o">&amp;</span><span class="n">表示逻辑与</span><span class="err">，</span><span class="o">|</span><span class="n">表示逻辑或</span><span class="err">，</span><span class="n">Q对象</span> <span class="n">前可以使用</span><span class="o">~</span><span class="n">操作符</span><span class="err">，</span><span class="n">表示非not</span><span class="p">.</span>
		<span class="n">BookInfo</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="o">~</span><span class="n">Q</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

	<span class="o">-</span> <span class="n">聚合查询</span>
	<span class="n">使用</span> <span class="n">aggregate</span><span class="p">(</span> <span class="p">)</span> <span class="n">过滤器调用聚合函数</span><span class="p">.</span>
	<span class="n">聚合函数包括</span><span class="err">：</span><span class="n">Avg</span> <span class="n">平均</span><span class="err">，</span><span class="n">Count</span> <span class="n">数量</span><span class="err">，</span><span class="n">Max</span> <span class="n">最大</span><span class="err">，</span><span class="n">Min</span> <span class="n">最小</span><span class="err">，</span><span class="n">Sum</span> <span class="n">求和</span><span class="err">，</span><span class="n">StdDev</span> <span class="n">标准差</span><span class="err">，</span><span class="n">Variance</span> <span class="n">方差</span>

	<span class="n">BookInfo</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">Sum</span><span class="p">(</span><span class="s">'bread'</span><span class="p">))</span>

	<span class="n">注意</span> <span class="n">aggregate</span> <span class="n">的返回值是一个字典类型</span><span class="err">，</span><span class="n">格式如下</span><span class="err">：</span><span class="p">{</span><span class="s">'属性名__聚合类小写'</span><span class="p">:</span><span class="n">值</span><span class="p">}</span><span class="err">，</span><span class="n">如</span><span class="p">:{</span><span class="s">'bread__sum'</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>

	<span class="n">使用</span> <span class="n">count</span> <span class="n">时一般不使用</span> <span class="n">aggregate</span><span class="p">(</span> <span class="p">)</span> <span class="n">过滤器</span><span class="err">，</span><span class="n">BookInfo</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">count</span><span class="p">()</span>

	<span class="o">-</span> <span class="n">排序</span>
	<span class="n">使用</span> <span class="n">order_by</span> <span class="n">对结果进行排序</span>
	<span class="n">BookInfo</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">all</span><span class="p">().</span><span class="n">order_by</span><span class="p">(</span><span class="s">'bread'</span><span class="p">)</span>  <span class="c1"># 升序
</span>	<span class="n">BookInfo</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">all</span><span class="p">().</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-bread'</span><span class="p">)</span>  <span class="c1"># 降序
</span>
	<span class="o">-</span> <span class="n">关联查询</span>
	<span class="mi">1</span><span class="err">、</span><span class="n">由一到多的访问</span><span class="err">：</span>
		<span class="n">一对应的模型类对象</span><span class="p">.</span><span class="n">多对应的模型类名小写_set</span><span class="err">，</span><span class="n">如果有related_name约束</span><span class="err">，</span><span class="n">可以直接用related_name替换多对应的模型类名小写_set</span>
	<span class="mi">2</span><span class="err">、</span><span class="n">由多到一的访问</span>
		<span class="n">多对应的模型类对象</span><span class="p">.</span><span class="n">外键名</span>
	<span class="mi">3</span><span class="err">、</span><span class="n">访问一对应的模型类关联对象的</span> <span class="nb">id</span>
		<span class="n">多对应的模型类对象</span><span class="p">.</span><span class="n">关联类属性_id</span>
	<span class="mi">4</span><span class="err">、</span><span class="n">关联过滤查询</span>
		<span class="n">由多模型类条件查询一模型类数据</span><span class="p">:</span>
			<span class="n">关联模型类名小写__属性名__条件运算符</span><span class="o">=</span><span class="n">值</span><span class="err">，</span><span class="n">BookInfo</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">heroinfo__hcomment__contains</span><span class="o">=</span><span class="s">'八'</span><span class="p">)</span>
		<span class="n">由一模型类条件查询多模型类数据</span><span class="p">:</span>
			<span class="n">一模型类关联属性名__一模型类属性名__条件运算符</span><span class="o">=</span><span class="n">值</span><span class="err">，</span><span class="n">HeroInfo</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">hbook__bread__gt</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

	<span class="o">-</span> <span class="n">其他方法</span>
	<span class="n">get_or_create</span><span class="p">(),</span><span class="n">首先尝试获取对象</span><span class="err">，</span><span class="n">不存在就创建</span><span class="err">，</span><span class="n">可以防止重复</span><span class="p">.</span><span class="n">返回的是一个元组</span><span class="err">，</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="bp">True</span><span class="o">/</span><span class="bp">False</span><span class="p">)</span><span class="err">，</span><span class="n">创建时返回</span> <span class="bp">True</span><span class="p">,</span> <span class="n">已经存在时返回</span> <span class="bp">False</span>

	<span class="n">reverse</span><span class="p">(),</span><span class="n">反向排序一个查询集</span><span class="err">，</span><span class="n">他只能对已经排了序的查询集进行反排</span>

	<span class="n">distinct</span><span class="p">(),</span><span class="n">返回一个在SQL</span> <span class="n">查询中使用SELECT</span> <span class="n">DISTINCT的新QuerySet</span><span class="err">。</span><span class="n">它将去除查询结果中重复的行</span><span class="err">。</span>

	<span class="n">values</span><span class="p">(),</span><span class="n">返回一个ValuesQuerySet</span> <span class="err">——</span><span class="n">QuerySet</span> <span class="n">的一个子类</span><span class="err">，</span><span class="n">迭代时返回字典而不是模型实例对象</span><span class="err">。</span><span class="n">values</span><span class="p">()</span> <span class="n">接收可选的位置参数</span><span class="o">*</span><span class="n">fields</span><span class="err">，</span><span class="n">它指定SELECT</span> <span class="n">应该限制哪些字段</span><span class="err">。</span><span class="n">如果指定字段</span><span class="err">，</span><span class="n">每个字典将只包含指定的字段的键</span><span class="o">/</span><span class="n">值</span><span class="err">。</span><span class="n">如果没有指定字段</span><span class="err">，</span><span class="n">每个字典将包含数据库表中所有字段的键和值</span><span class="err">。</span>
		<span class="c1"># 返回对象
</span>		<span class="o">&gt;&gt;&gt;</span> <span class="n">Blog</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">name__startswith</span><span class="o">=</span><span class="s">'Beatles'</span><span class="p">)</span>
		<span class="p">[</span><span class="o">&lt;</span><span class="n">Blog</span><span class="p">:</span> <span class="n">Beatles</span> <span class="n">Blog</span><span class="o">&gt;</span><span class="p">]</span>
		<span class="c1"># 将对象转成字典再返回.
</span>		<span class="o">&gt;&gt;&gt;</span> <span class="n">Blog</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">name__startswith</span><span class="o">=</span><span class="s">'Beatles'</span><span class="p">).</span><span class="n">values</span><span class="p">()</span>
		<span class="p">[{</span><span class="s">'id'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'name'</span><span class="p">:</span> <span class="s">'Beatles Blog'</span><span class="p">,</span> <span class="s">'tagline'</span><span class="p">:</span> <span class="s">'All the latest Beatles news.'</span><span class="p">}]</span>
		<span class="c1"># 查询指定字段并返回
</span>		<span class="o">&gt;&gt;&gt;</span> <span class="n">Blog</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">values</span><span class="p">()</span>
		<span class="p">[{</span><span class="s">'id'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'name'</span><span class="p">:</span> <span class="s">'Beatles Blog'</span><span class="p">,</span> <span class="s">'tagline'</span><span class="p">:</span> <span class="s">'All the latest Beatles news.'</span><span class="p">}],</span>
		<span class="o">&gt;&gt;&gt;</span> <span class="n">Blog</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">values</span><span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">)</span>
		<span class="p">[{</span><span class="s">'id'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'name'</span><span class="p">:</span> <span class="s">'Beatles Blog'</span><span class="p">}]</span>
	
	<span class="n">values_list</span><span class="p">(),</span> <span class="n">获取元组形式结果</span>
		<span class="o">&gt;&gt;&gt;</span><span class="n">Author</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">'name'</span><span class="p">,</span> <span class="s">'qq'</span><span class="p">)</span>
		<span class="o">&gt;&gt;&gt;</span> <span class="o">&lt;</span><span class="n">QuerySet</span> <span class="p">[(</span><span class="sa">u</span><span class="s">'WeizhongTu'</span><span class="p">,</span> <span class="sa">u</span><span class="s">'336643078'</span><span class="p">),</span> <span class="p">(</span><span class="sa">u</span><span class="s">'twz915'</span><span class="p">,</span> <span class="sa">u</span><span class="s">'915792575'</span><span class="p">),</span> <span class="p">(</span><span class="sa">u</span><span class="s">'wangdachui'</span><span class="p">,</span> <span class="sa">u</span><span class="s">'353506297'</span><span class="p">),</span> <span class="p">(</span><span class="sa">u</span><span class="s">'xiaoming'</span><span class="p">,</span> <span class="sa">u</span><span class="s">'004466315'</span><span class="p">)]</span><span class="o">&gt;</span>
		<span class="o">&gt;&gt;&gt;</span><span class="nb">list</span><span class="p">(</span><span class="n">Author</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">'name'</span><span class="p">,</span> <span class="s">'qq'</span><span class="p">))</span>
		<span class="o">&gt;&gt;&gt;</span><span class="p">[(</span><span class="sa">u</span><span class="s">'WeizhongTu'</span><span class="p">,</span> <span class="sa">u</span><span class="s">'336643078'</span><span class="p">),(</span><span class="sa">u</span><span class="s">'twz915'</span><span class="p">,</span> <span class="sa">u</span><span class="s">'915792575'</span><span class="p">),(</span><span class="sa">u</span><span class="s">'wangdachui'</span><span class="p">,</span> <span class="sa">u</span><span class="s">'353506297'</span><span class="p">),(</span><span class="sa">u</span><span class="s">'xiaoming'</span><span class="p">,</span> <span class="sa">u</span><span class="s">'004466315'</span><span class="p">)]</span>

	<span class="n">latest</span><span class="p">(</span><span class="n">条件</span><span class="p">),</span><span class="n">返回最近的一条记录</span><span class="err">，</span><span class="n">使用条件作为依据</span><span class="err">，</span><span class="n">如Entry</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">latest</span><span class="p">(</span><span class="s">'pub_date'</span><span class="p">)</span>

	<span class="n">earliest</span><span class="p">(),</span><span class="n">同上</span><span class="err">，</span><span class="n">只不过是最早的</span>

	<span class="n">first</span><span class="p">(),</span><span class="n">返回结果集的第一个对象</span><span class="p">,</span> <span class="n">当没有找到时返回None</span><span class="p">.</span><span class="n">如果QuerySet</span> <span class="n">没有设置排序</span><span class="p">,</span><span class="n">则将会自动按主键进行排序</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">Article</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'title'</span><span class="p">,</span> <span class="s">'pub_date'</span><span class="p">).</span><span class="n">first</span><span class="p">()</span>

	<span class="n">last</span><span class="p">(),</span><span class="n">同上</span><span class="err">，</span><span class="n">只不过是最后一个</span>

	<span class="n">exists</span><span class="p">()</span><span class="err">：</span><span class="n">判断查询集中是否有数据</span><span class="err">，</span><span class="n">如果有则返回</span> <span class="bp">True</span><span class="err">，</span><span class="n">没有则返回</span> <span class="bp">False</span><span class="err">。</span>
		<span class="n">some_queryset</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">entry</span><span class="p">.</span><span class="n">pk</span><span class="p">).</span><span class="n">exists</span><span class="p">()</span>
	
	<span class="n">select_related</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">fields</span><span class="p">):</span><span class="n">性能相关</span><span class="err">：</span><span class="n">表之间进行join连表操作</span><span class="err">，</span><span class="n">一次性获取关联的数据</span><span class="err">。</span>
		<span class="n">model</span><span class="p">.</span><span class="n">tb</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">all</span><span class="p">().</span><span class="n">select_related</span><span class="p">()</span>
		<span class="n">model</span><span class="p">.</span><span class="n">tb</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">all</span><span class="p">().</span><span class="n">select_related</span><span class="p">(</span><span class="s">'外键字段'</span><span class="p">)</span>
		<span class="n">model</span><span class="p">.</span><span class="n">tb</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">all</span><span class="p">().</span><span class="n">select_related</span><span class="p">(</span><span class="s">'外键字段__外键字段'</span><span class="p">)</span>

	<span class="n">prefetch_related</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">lookups</span><span class="p">)</span><span class="err">：</span><span class="n">性能相关</span><span class="err">：</span><span class="n">多表连表操作时速度会慢</span><span class="err">，</span><span class="n">使用其执行多次SQL查询</span>  <span class="n">在内存中做关联</span><span class="err">，</span><span class="n">而不会再做连表查询</span><span class="p">;</span><span class="n">相当于进行子语句查询</span>
		<span class="c1"># 第一次 获取所有用户表
</span>		<span class="c1"># 第二次 获取用户类型表where id in (用户表中的查到的所有用户ID)
</span>		<span class="n">models</span><span class="p">.</span><span class="n">UserInfo</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">prefetch_related</span><span class="p">(</span><span class="s">'外键字段'</span><span class="p">)</span>

	<span class="n">annotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="err">：</span><span class="n">用于实现聚合group</span> <span class="n">by查询</span>
		<span class="n">qs</span> <span class="o">=</span> <span class="n">Question</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">thumbs</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="s">'thumbups'</span><span class="p">)</span> <span class="o">-</span> <span class="n">F</span><span class="p">(</span><span class="s">'thumbdowns'</span><span class="p">)).</span><span class="n">order_by</span><span class="p">(</span><span class="s">"-thumbs"</span><span class="p">)</span>

	<span class="n">extra</span><span class="p">(),</span><span class="n">实现</span> <span class="n">别名</span><span class="err">，</span><span class="n">条件</span><span class="err">，</span><span class="n">排序等</span>
		<span class="n">SELECT</span> <span class="n">name</span> <span class="n">AS</span> <span class="n">tag_name</span> <span class="n">FROM</span> <span class="n">blog_tag</span><span class="p">;</span>
		<span class="n">tags</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">all</span><span class="p">().</span><span class="n">extra</span><span class="p">(</span><span class="n">select</span><span class="o">=</span><span class="p">{</span><span class="s">'tag_name'</span><span class="p">:</span> <span class="s">'name'</span><span class="p">})</span>
		<span class="n">tags</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">name或者tags</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">tag_name都能取出值</span>

	<span class="n">下面两个</span> <span class="n">取到的是对象</span><span class="err">，</span><span class="n">并且注意</span> <span class="n">取到的对象可以</span> <span class="n">获取其他字段</span><span class="err">（</span><span class="n">这样会再去查找该字段降低性能</span>
	<span class="n">defer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">fields</span><span class="p">)</span><span class="err">：</span><span class="n">排除不需要的字段</span>
		<span class="n">UserInfo</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">defer</span><span class="p">(</span><span class="s">'username'</span><span class="p">,</span><span class="s">'id'</span><span class="p">)</span>  <span class="c1"># 查出的字段不包含username和id
</span>		<span class="n">UserInfo</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">(...).</span><span class="n">defer</span><span class="p">(</span><span class="s">'username'</span><span class="p">,</span><span class="s">'id'</span><span class="p">)</span>
	
	<span class="n">only</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">fields</span><span class="p">)</span><span class="err">：</span><span class="n">仅选择需要的字段</span>
		<span class="n">UserInfo</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">only</span><span class="p">(</span><span class="s">'username'</span><span class="p">,</span><span class="s">'id'</span><span class="p">)</span>  <span class="c1"># 查出的字段只包含username和id
</span>		<span class="n">UserInfo</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">(...).</span><span class="n">only</span><span class="p">(</span><span class="s">'username'</span><span class="p">,</span><span class="s">'id'</span><span class="p">)</span>
</pre></table></code></div></div><h2 id="75查询集queryset">7.5.查询集QuerySet</h2><p>查询集，也称查询结果集、QuerySet，表示从数据库中获取的对象集合。</p><p>all(),filter(),exclude(),order_by()会返回查询集</p><p>判断某一个查询集中是否有数据：</p><p>exists()：判断查询集中是否有数据，如果有则返回 True，没有则返回 False。 查询集.exists()</p><p>两大特性</p><ul><li>惰性执行:创建查询集不会访问数据库，直到调用数据时，才会访问数据库，调用数据的情况包括迭代、序列化、与if合用<li>缓存:使用同一个查询集，第一次使用时会发生数据库的查询，然后Django会把结果缓存下来，再次使用这个查询集时会使用缓存的数据，减少了数据库的查询次数。</ul><p>限制查询集：可以对查询集进行取下标或切片操作，注意：不支持负数索引。对查询集进行切片后返回一个新的查询集，不会立即执行查询。</p><h2 id="76管理器manager">7.6.管理器Manager</h2><p>管理器是 Django 的模型进行数据库操作的接口</p><p>在通过模型类的 objects 属性提供的方法操作数据库时，即是在使用一个管理器对象 objects</p><p>自定义管理器：</p><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="mf">1.</span> <span class="n">修改原始查询集</span><span class="err">，</span><span class="n">重写</span> <span class="nb">all</span><span class="p">()</span> <span class="n">方法</span><span class="err">。</span>
	<span class="n">a</span><span class="err">）</span><span class="n">打开</span> <span class="n">booktest</span> <span class="o">/</span> <span class="n">models</span><span class="p">.</span><span class="n">py</span> <span class="n">文件</span><span class="err">，</span><span class="n">定义类</span> <span class="n">BookInfoManager</span>
	<span class="c1">#图书管理器
</span>	<span class="k">class</span> <span class="nc">BookInfoManager</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Manager</span><span class="p">):</span>
		<span class="k">def</span> <span class="nf">all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
			<span class="c1">#默认查询未删除的图书信息
</span>			<span class="c1">#调用父类的成员语法为：super().方法名
</span>			<span class="k">return</span> <span class="nb">super</span><span class="p">().</span><span class="nb">filter</span><span class="p">(</span><span class="n">is_delete</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
	<span class="n">b</span><span class="err">）</span><span class="n">在模型类BookInfo中定义管理器</span>
	<span class="k">class</span> <span class="nc">BookInfo</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
		<span class="p">...</span>
		<span class="n">books</span> <span class="o">=</span> <span class="n">BookInfoManager</span><span class="p">()</span>
	<span class="n">c</span><span class="err">）</span><span class="n">使用方法</span>
	<span class="n">BookInfo</span><span class="p">.</span><span class="n">books</span><span class="p">.</span><span class="nb">all</span><span class="p">()</span>

<span class="mf">2.</span> <span class="n">在管理器类中补充定义新的方法</span>
	<span class="n">a</span><span class="err">）</span><span class="n">打开</span> <span class="n">booktest</span> <span class="o">/</span> <span class="n">models</span><span class="p">.</span><span class="n">py</span> <span class="n">文件</span><span class="err">，</span><span class="n">定义方法</span> <span class="n">create</span>
	<span class="k">class</span> <span class="nc">BookInfoManager</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Manager</span><span class="p">):</span>
		<span class="c1">#创建模型类，接收参数为属性赋值
</span>		<span class="k">def</span> <span class="nf">create_book</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">pub_date</span><span class="p">):</span>
			<span class="c1">#创建模型类对象self.model可以获得模型类
</span>			<span class="n">book</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">()</span>
			<span class="n">book</span><span class="p">.</span><span class="n">btitle</span> <span class="o">=</span> <span class="n">title</span>
			<span class="n">book</span><span class="p">.</span><span class="n">bpub_date</span> <span class="o">=</span> <span class="n">pub_date</span>
			<span class="n">book</span><span class="p">.</span><span class="n">bread</span><span class="o">=</span><span class="mi">0</span>
			<span class="n">book</span><span class="p">.</span><span class="n">bcommet</span><span class="o">=</span><span class="mi">0</span>
			<span class="n">book</span><span class="p">.</span><span class="n">is_delete</span> <span class="o">=</span> <span class="bp">False</span>
			<span class="c1"># 将数据插入进数据表
</span>			<span class="n">book</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
			<span class="k">return</span> <span class="n">book</span>
	<span class="n">b</span><span class="err">）</span><span class="n">为模型类</span> <span class="n">BookInfo</span> <span class="n">定义管理器</span> <span class="n">books</span> <span class="n">语法如下</span>
	<span class="k">class</span> <span class="nc">BookInfo</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
		<span class="p">...</span>
		<span class="n">books</span> <span class="o">=</span> <span class="n">BookInfoManager</span><span class="p">()</span>
	<span class="n">c</span><span class="err">）</span><span class="n">调用语法如下</span><span class="err">：</span>
	<span class="n">book</span><span class="o">=</span><span class="n">BookInfo</span><span class="p">.</span><span class="n">books</span><span class="p">.</span><span class="n">create_book</span><span class="p">(</span><span class="s">"abc"</span><span class="p">,</span><span class="n">date</span><span class="p">(</span><span class="mi">1980</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/django/'>Django</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/web%E5%BC%80%E5%8F%91%E6%8A%80%E6%9C%AF/" class="post-tag no-text-decoration" >Web开发技术</a> <a href="/tags/django/" class="post-tag no-text-decoration" >Django</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Django基础 - 图样图森破&url=https://justzxy.cn/posts/django-note/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Django基础 - 图样图森破&u=https://justzxy.cn/posts/django-note/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Django基础 - 图样图森破&url=https://justzxy.cn/posts/django-note/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/js/">JavaScript基础整理</a><li><a href="/posts/http-code/">HTTP 响应码</a><li><a href="/posts/pip/">python包管理工具pip</a><li><a href="/posts/pyecharts-pie/">pyecharts饼图使用笔记</a><li><a href="/posts/redis-fast/">Redis为什么这么快</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/python%E6%A0%87%E5%87%86%E5%BA%93/">Python标准库</a> <a class="post-tag" href="/tags/web%E5%BC%80%E5%8F%91%E6%8A%80%E6%9C%AF/">Web开发技术</a> <a class="post-tag" href="/tags/python%E8%BF%9B%E9%98%B6/">Python进阶</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/">计算机基础</a> <a class="post-tag" href="/tags/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">环境配置</a> <a class="post-tag" href="/tags/django/">Django</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/python%E5%9F%BA%E7%A1%80/">Python基础</a> <a class="post-tag" href="/tags/redis/">Redis</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/js/"><div class="card-body"> <span class="timeago small" > Nov 29, 2020 <i class="unloaded">2020-11-29T23:57:41+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>JavaScript基础整理</h3><div class="text-muted small"><p> JavaScript 使用方式 ①行内式，②内嵌式，③外链式 数据类型： ① number ② string ③ boolean(true和false) ④ undefined：undefined类型，变量声明未初始化，它的值就是undefined ⑤ null：null类型，表示空对象，如果定义的变量将来准备保存对象，可以将变量初始化为null,在页面上获取不到对象，返回的...</p></div></div></a></div><div class="card"> <a href="/posts/jwt/"><div class="card-body"> <span class="timeago small" > May 10, 2018 <i class="unloaded">2018-05-10T23:47:26+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>JWT认证机制</h3><div class="text-muted small"><p> JWT认证机制 session认证机制 我们知道，http协议本身是一种无状态的协议，而这就意味着如果用户向我们的应用提供了用户名和密码来进行用户认证，那么下一次请求时，用户还要再一次进行用户认证才行，因为根据http协议，我们并不能知道是哪个用户发出的请求，所以为了让我们的应用能识别是哪个用户发出的请求，我们只能在服务器存储一份用户登录的信息，这份登录信息会在响应时传递给浏览器，告诉其...</p></div></div></a></div><div class="card"> <a href="/posts/http-code/"><div class="card-body"> <span class="timeago small" > Dec 1, 2020 <i class="unloaded">2020-12-01T23:38:41+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTTP 响应码</h3><div class="text-muted small"><p> HTTP 响应状态代码指示特定 HTTP请求是否已成功完成。响应分为五类：信息响应(100–199)，成功响应(200–299)，重定向(300–399)，客户端错误(400–499)和服务器错误 (500–599)。状态代码由 section 10 of RFC 2616定义 信息响应 100 Continue 这个临时响应表明，迄今为止的所有内容都是可行的，...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/os-module/" class="btn btn-outline-primary" prompt="Older"><p>os模块</p></a> <a href="/posts/property/" class="btn btn-outline-primary" prompt="Newer"><p>property属性</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 tooYoungtooSimple. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/python%E6%A0%87%E5%87%86%E5%BA%93/">Python标准库</a> <a class="post-tag" href="/tags/web%E5%BC%80%E5%8F%91%E6%8A%80%E6%9C%AF/">Web开发技术</a> <a class="post-tag" href="/tags/python%E8%BF%9B%E9%98%B6/">Python进阶</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/">计算机基础</a> <a class="post-tag" href="/tags/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">环境配置</a> <a class="post-tag" href="/tags/django/">Django</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/python%E5%9F%BA%E7%A1%80/">Python基础</a> <a class="post-tag" href="/tags/redis/">Redis</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://justzxy.cn{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script>
